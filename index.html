<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام المبيعات والمخزون</title>
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#e74c3c">
</head>
<body>

    <div id="startupMsg" class="startup-msg">هل صليت على محمد وآل محمد اليوم؟</div>

    <div id="customAlertContainer" class="custom-alert-container"></div>

    <div class="navbar">
        <div class="tabs">
            <button class="active" onclick="switchTab('salesTab')">البيع المباشر</button>
            <button onclick="switchTab('inventoryTab')">المخزون</button>
            <button onclick="switchTab('historyTab')">سجل المبيعات</button>
            <button onclick="switchTab('settingsTab')">الإعدادات</button>
        </div>
    </div>

    <div id="salesTab" class="container active">
        <h3>تسجيل مبيعات جديدة</h3>
        
        <div class="form-group">
            <input type="text" id="customerName" placeholder="اسم العميل (اختياري)">
            <input type="tel" id="customerPhone" placeholder="رقم الهاتف (اختياري)">
        </div>

        <div class="form-group" style="align-items: center;">
            <input list="itemList" id="searchItem" placeholder="ابحث عن سلعة (اكتب أول حرف)...">
            <datalist id="itemList"></datalist>
            
            <input type="number" id="saleQty" placeholder="الكمية" value="1" min="1" style="flex: 0.5;">
            <button class="btn btn-icon" onclick="addToCart()">+</button>
        </div>

        <table id="cartTable">
            <thead>
                <tr>
                    <th>السلعة</th>
                    <th>السعر</th>
                    <th>الكمية</th>
                    <th>الإجمالي</th>
                    <th>إجراء</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>

        <div class="total-section">
            الإجمالي الكلي: <span id="grandTotal">0</span>
        </div>
        <button class="btn" style="width: 100%; margin-top: 20px;" onclick="checkout()">إتمام البيع</button>
    </div>

    <div id="inventoryTab" class="container">
        <h3>إدارة السلع والمخزون</h3>
        
        <div class="form-group" id="productForm">
            <input type="hidden" id="editIndex">
            <input type="text" id="itemName" placeholder="اسم السلعة">
            <input type="number" id="itemPrice" placeholder="سعر البيع">
            <input type="number" id="itemQty" placeholder="الكمية المتوفرة">
            <button class="btn" onclick="saveItem()" id="saveBtn">إضافة سلعة</button>
        </div>

        <table id="inventoryTable">
            <thead>
                <tr>
                    <th>اسم السلعة</th>
                    <th>السعر</th>
                    <th>الكمية المتوفرة</th>
                    <th>إجراءات</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <div id="historyTab" class="container">
        <h3>سجل المبيعات</h3>
        <div class="total-section" style="margin-bottom: 20px; text-align: center; background: #fdf2e9; padding: 15px; border-radius: 8px;">
            إجمالي مبيعات اليوم: <span id="todayTotal">0</span>
        </div>
        
        <div id="salesHistoryContainer">
            </div>

        <button class="btn btn-danger" style="width: 100%; margin-top: 30px;" onclick="resetAllData()">تصفير جميع الحسابات والمخزون</button>
    </div>

    <div id="settingsTab" class="container">
        <h3>الإعدادات</h3>
        <div style="display: flex; flex-direction: column; gap: 15px; margin-top: 20px;">
            <button class="btn" onclick="backupData()">تحميل نسخة احتياطية</button>
            
            <label class="btn btn-edit" style="text-align: center; cursor: pointer;">
                رفع نسخة احتياطية
                <input type="file" id="restoreFile" accept=".json" style="display: none;" onchange="restoreData(event)">
            </label>

            <a href="https://t.me/am_an12" target="_blank" class="btn" style="background-color: #3498db; text-align: center; text-decoration: none;">المطور والتحديثات عبر التلغرام @am_an12</a>
        </div>
    </div>

    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js')
                .then(registration => {
                    console.log('ServiceWorker registration successful with scope: ', registration.scope);
                })
                .catch(err => {
                    console.log('ServiceWorker registration failed: ', err);
                });
            });
        }
    </script>

    <script type="module" src="script.js"></script>
</body>
</html>
