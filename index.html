<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام الجرد وحساب الأرباح</title>
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#e74c3c">
</head>
<body>

    <div id="startupMsg" class="startup-msg">هل صليت على محمد وآل محمد اليوم؟</div>

    <div id="customAlertContainer" class="custom-alert-container"></div>

    <div class="navbar">
        <div class="tabs">
            <button class="active" onclick="switchTab('productsTab')">المنتجات</button>
            <button onclick="switchTab('inventoryTab')">الجرد</button>
            <button onclick="switchTab('settingsTab')">الإعدادات</button>
        </div>
    </div>

    <div id="productsTab" class="container active">
        <h3>إدارة المنتجات</h3>
        
        <div class="form-group" id="productForm">
            <input type="hidden" id="editIndex">
            <input type="text" id="itemName" placeholder="اسم المنتج">
            <input type="number" id="itemBuyPrice" placeholder="سعر الشراء">
            <input type="number" id="itemSellPrice" placeholder="سعر البيع">
            <input type="number" id="itemQty" placeholder="الكمية الأصلية">
            <button class="btn" onclick="saveItem()" id="saveBtn">إضافة منتج</button>
        </div>

        <table id="productsTable">
            <thead>
                <tr>
                    <th>المنتج</th>
                    <th>الشراء</th>
                    <th>البيع</th>
                    <th>الكمية</th>
                    <th>إجراءات</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>

        <div class="total-section">
            مجموع الشراء الكلي: <span id="totalBuyPrice">0</span>
        </div>
    </div>

    <div id="inventoryTab" class="container">
        <h3>الجرد الفعلي</h3>
        
        <table id="inventoryTable">
            <thead>
                <tr>
                    <th>المنتج</th>
                    <th>الأصلية</th>
                    <th>المتبقية</th>
                    <th>المباعة</th>
                    <th>الربح</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
        <div class="total-section">
            مجموع الأرباح الحالية: <span id="currentTotalProfit">0</span>
        </div>
    </div>

    <div id="settingsTab" class="container">
        <h3>الإعدادات</h3>
        <div style="display: flex; flex-direction: column; gap: 15px; margin-top: 20px;">
            <button class="btn" onclick="backupData()">تحميل نسخة احتياطية</button>
            
            <label class="btn btn-edit" style="text-align: center; cursor: pointer;">
                رفع نسخة احتياطية
                <input type="file" id="restoreFile" accept=".json" style="display: none;" onchange="restoreData(event)">
            </label>

            <button class="btn btn-danger" onclick="resetAllData()">تصفير جميع الحسابات والجرد نهائياً</button>

            <a href="https://t.me/am_an12" target="_blank" class="btn" style="background-color: #3498db; text-align: center; text-decoration: none;">المطور والتحديثات عبر التلغرام @am_an12</a>
        </div>
    </div>

    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js')
                .then(registration => {
                    console.log('ServiceWorker registration successful with scope: ', registration.scope);
                })
                .catch(err => {
                    console.log('ServiceWorker registration failed: ', err);
                });
            });
        }
    </script>

    <script type="module" src="script.js"></script>
</body>
</html>
